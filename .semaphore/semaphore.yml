version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu2004
blocks:
  - name: Run test
    task:
      jobs:
        - name: test
          commands:
            - docker/run.sh -it paparazziuav/pprz-ci bash test.sh
      prologue:
        commands:
          - docker pull paparazziuav/pprz-ci
          - echo "git config --global --add safe.directory '*'" > test.sh
          - echo "ln -s /usr/bin/python3 /usr/bin/python" >> test.sh
          - echo "make test" >> test.sh
          - echo "git config --global --add safe.directory '*'" > test_all.sh
          - echo "ln -s /usr/bin/python3 /usr/bin/python" >> test_all.sh
          - echo "make test_all_confs" >> test_all.sh
          - git config --global user.email "paparazzi-devel@nongnu.org"
          - git config --global user.name "Paparazzi UAV"
          - checkout
          - git submodule update --init --force --recursive
    dependencies: []
