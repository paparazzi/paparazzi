<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="http://jsbsim.sourceforge.net/JSBSim.xsl"?>
<fdm_config name="HEX COMPLETE EXT" version="2.0" release="BETA" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://jsbsim.sourceforge.net/JSBSim.xsd">

  <fileheader>
    <author>Till Blaha</author>
    <filecreationdate>19-09-2022</filecreationdate>
    <version>Version 0.1 - beta</version>
    <description>Flamewheel with actuator dynamics</description>
  </fileheader>

  <metrics>
    <wingarea unit="IN2"> 78.53 </wingarea>
    <wingspan unit="IN"> 10 </wingspan>
    <chord unit="IN"> 6.89 </chord>
    <htailarea unit="FT2"> 0 </htailarea>
    <htailarm unit="FT"> 0 </htailarm>
    <vtailarea unit="FT2"> 0 </vtailarea>
    <vtailarm unit="FT"> 0 </vtailarm>
    <location name="AERORP" unit="IN">
      <x> 0 </x>
      <y> 0 </y>
      <z> 0 </z>
    </location>
    <location name="EYEPOINT" unit="IN">
      <x> 0 </x>
      <y> 0 </y>
      <z> 0 </z>
    </location>
    <location name="VRP" unit="IN">
      <x> 0 </x>
      <y> 0 </y>
      <z> 0 </z>
    </location>
  </metrics>

  <mass_balance>
    <ixx unit="SLUG*FT2"> 0.004 </ixx> <!-- factor 10 higher than bebop (?)-->
    <iyy unit="SLUG*FT2"> 0.004 </iyy>
    <izz unit="SLUG*FT2"> 0.0047 </izz>
    <ixy unit="SLUG*FT2"> 0. </ixy>
    <ixz unit="SLUG*FT2"> 0. </ixz>
    <iyz unit="SLUG*FT2"> 0. </iyz>
        <emptywt unit="LBS"> 3.8 </emptywt> <!-- ? -->
    <location name="CG" unit="M">
      <x> 0 </x>
      <y> 0 </y>
      <z> 0 </z>
    </location>
  </mass_balance>

  <ground_reactions>
    <contact type="STRUCTURE" name="CONTACT_FRONT">
      <location unit="M">
        <x>-0.15 </x>
        <y> 0 </y>
        <z>-0.1 </z>
      </location>
      <static_friction>  0.8 </static_friction>
      <dynamic_friction> 0.5 </dynamic_friction>
      <spring_coeff unit="N/M"> 500 </spring_coeff>
      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
      <max_steer unit="DEG"> 0.0 </max_steer>
      <brake_group> NONE </brake_group>
      <retractable>0</retractable>
    </contact>

    <contact type="STRUCTURE" name="CONTACT_BACK">
      <location unit="M">
        <x> 0.15</x>
        <y> 0   </y>
        <z>-0.1 </z>
      </location>
      <static_friction>  0.8 </static_friction>
      <dynamic_friction> 0.5 </dynamic_friction>
      <spring_coeff unit="N/M"> 500 </spring_coeff>
      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
      <max_steer unit="DEG"> 0.0 </max_steer>
      <brake_group> NONE </brake_group>
      <retractable>0</retractable>
    </contact>

    <contact type="STRUCTURE" name="CONTACT_RIGHT">
      <location unit="M">
        <x> 0.  </x>
        <y> 0.15</y>
        <z>-0.1 </z>
      </location>
      <static_friction>  0.8 </static_friction>
      <dynamic_friction> 0.5 </dynamic_friction>
      <spring_coeff unit="N/M"> 500 </spring_coeff>
      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
      <max_steer unit="DEG"> 0.0 </max_steer>
      <brake_group> NONE </brake_group>
      <retractable>0</retractable>
    </contact>

    <contact type="STRUCTURE" name="CONTACT_LEFT">
      <location unit="M">
        <x> 0.  </x>
        <y>-0.15</y>
        <z>-0.1 </z>
      </location>
      <static_friction>  0.8 </static_friction>
      <dynamic_friction> 0.5 </dynamic_friction>
      <spring_coeff unit="N/M"> 500 </spring_coeff>
      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
      <max_steer unit="DEG"> 0.0 </max_steer>
      <brake_group> NONE </brake_group>
      <retractable>0</retractable>
    </contact>
  </ground_reactions>

  <flight_control name="actuator_dynamics">
    <channel name="filtering">

      <!--First order filter represents actuator dynamics-->
      <lag_filter name="fr_motor_lag">
        <input> fcs/fr_motor </input>
        <c1> 50 </c1>
        <output> fcs/fr_motor_lag</output>
      </lag_filter>
      <lag_filter name="mr_motor_lag">
        <input> fcs/mr_motor </input>
        <c1> 50 </c1>
        <output> fcs/mr_motor_lag</output>
      </lag_filter>
      <lag_filter name="rr_motor_lag">
        <input> fcs/rr_motor </input>
        <c1> 50 </c1>
        <output> fcs/rr_motor_lag</output>
      </lag_filter>
      <lag_filter name="rl_motor_lag">
        <input> fcs/rl_motor </input>
        <c1> 50 </c1>
        <output> fcs/rl_motor_lag</output>
      </lag_filter>
      <lag_filter name="ml_motor_lag">
        <input> fcs/ml_motor </input>
        <c1> 50 </c1>
        <output> fcs/ml_motor_lag</output>
      </lag_filter>
      <lag_filter name="fl_motor_lag">
        <input> fcs/fl_motor </input>
        <c1> 50 </c1>
        <output> fcs/fl_motor_lag</output>
      </lag_filter>

      <!--Derivative of actuator dynamics for spinup torque-->
      <washout_filter name="fr_motor_d">
        <input> fcs/fr_motor </input>
        <c1> 50 </c1>
        <output> fcs/fr_motor_d</output>
      </washout_filter>
      <washout_filter name="mr_motor_d">
        <input> fcs/mr_motor </input>
        <c1> 50 </c1>
        <output> fcs/mr_motor_d</output>
      </washout_filter>
      <washout_filter name="rr_motor_d">
        <input> fcs/rr_motor </input>
        <c1> 50 </c1>
        <output> fcs/rr_motor_d</output>
      </washout_filter>
      <washout_filter name="rl_motor_d">
        <input> fcs/rl_motor </input>
        <c1> 50 </c1>
        <output> fcs/rl_motor_d</output>
      </washout_filter>
      <washout_filter name="ml_motor_d">
        <input> fcs/ml_motor </input>
        <c1> 50 </c1>
        <output> fcs/ml_motor_d</output>
      </washout_filter>
      <washout_filter name="fl_motor_d">
        <input> fcs/fl_motor </input>
        <c1> 50 </c1>
        <output> fcs/fl_motor_d</output>
      </washout_filter>

      <pure_gain name="g2timesactd">
        <input>fcs/fr_motor_d</input>
        <gain>1.2</gain> <!-- times 4 from bebop-->
        <output>fcs/g2timesactd</output>
      </pure_gain>
      <pure_gain name="g1timesact">
        <input>fcs/fr_motor_lag</input>
        <gain>0.17</gain>
        <output>fcs/g1timesact</output>
      </pure_gain>
      <summer name="summer0">
        <input>fcs/g2timesactd</input>
        <input>fcs/g1timesact</input>
        <output>fcs/yawcontrol</output>
      </summer>

      <pure_gain name="g2timesactd1">
        <input>fcs/mr_motor_d</input>
        <gain>1.2</gain>
        <output>fcs/g2timesactd1</output>
      </pure_gain>
      <pure_gain name="g1timesact1">
        <input>fcs/mr_motor_lag</input>
        <gain>0.17</gain>
        <output>fcs/g1timesact1</output>
      </pure_gain>
      <summer name="summer1">
        <input>fcs/g2timesactd1</input>
        <input>fcs/g1timesact1</input>
        <output>fcs/yawcontrol1</output>
      </summer>

      <pure_gain name="g2timesactd2">
        <input>fcs/rr_motor_d</input>
        <gain>1.2</gain>
        <output>fcs/g2timesactd2</output>
      </pure_gain>
      <pure_gain name="g1timesact">
        <input>fcs/rr_motor_lag</input>
        <gain>0.17</gain>
        <output>fcs/g1timesact2</output>
      </pure_gain>
      <summer name="summer2">
        <input>fcs/g2timesactd2</input>
        <input>fcs/g1timesact2</input>
        <output>fcs/yawcontrol2</output>
      </summer>

      <pure_gain name="g2timesactd3">
        <input>fcs/rl_motor_d</input>
        <gain>1.2</gain>
        <output>fcs/g2timesactd3</output>
      </pure_gain>
      <pure_gain name="g1timesact">
        <input>fcs/rl_motor_lag</input>
        <gain>0.17</gain>
        <output>fcs/g1timesact3</output>
      </pure_gain>
      <summer name="summer3">
        <input>fcs/g2timesactd3</input>
        <input>fcs/g1timesact3</input>
        <output>fcs/yawcontrol3</output>
      </summer>

      <pure_gain name="g2timesactd4">
        <input>fcs/ml_motor_d</input>
        <gain>1.2</gain>
        <output>fcs/g2timesactd4</output>
      </pure_gain>
      <pure_gain name="g1timesact">
        <input>fcs/ml_motor_lag</input>
        <gain>0.17</gain>
        <output>fcs/g1timesact4</output>
      </pure_gain>
      <summer name="summer4">
        <input>fcs/g2timesactd4</input>
        <input>fcs/g1timesact4</input>
        <output>fcs/yawcontrol4</output>
      </summer>

      <pure_gain name="g2timesactd5">
        <input>fcs/fl_motor_d</input>
        <gain>1.2</gain>
        <output>fcs/g2timesactd5</output>
      </pure_gain>
      <pure_gain name="g1timesact">
        <input>fcs/fl_motor_lag</input>
        <gain>0.17</gain>
        <output>fcs/g1timesact5</output>
      </pure_gain>
      <summer name="summer5">
        <input>fcs/g2timesactd5</input>
        <input>fcs/g1timesact5</input>
        <output>fcs/yawcontrol5</output>
      </summer>
    </channel>
  </flight_control>

  <external_reactions>

    <property>fcs/fr_motor</property>
    <property>fcs/fr_motor_lag</property>
    <property>fcs/mr_motor</property>
    <property>fcs/mr_motor_lag</property>
    <property>fcs/rr_motor</property>
    <property>fcs/rr_motor_lag</property>
    <property>fcs/rl_motor</property>
    <property>fcs/rl_motor_lag</property>
    <property>fcs/ml_motor</property>
    <property>fcs/ml_motor_lag</property>
    <property>fcs/fl_motor</property>
    <property>fcs/fl_motor_lag</property>


    <!-- First the lift forces produced by each propeller -->
    <!-- locations:
      >>> import numpy as np
      >>> th = np.linspace(0., 2*np.pi, 7)[:6] + 2*np.pi/12
      >>> np.array([-5*np.cos(th), 5*np.sin(th)]).T
    -->

    <force name="fr_motor" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/fr_motor_lag</property>
          <value> 1.7 </value> <!-- factor 4 higher than bebop -->
        </product>
      </function>
      <location unit="IN">
        <x>-4.33</x>
        <y>2.5</y>
        <z>0</z>
      </location>
      <direction>
        <x>0</x>
        <y>0</y>
        <z>-1</z>
      </direction>
    </force>

    <force name="mr_motor" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/mr_motor_lag</property>
          <value> 1.7 </value>
        </product>
      </function>
      <location unit="IN">
        <x>0.0</x>
        <y>5.0</y>
        <z>0</z>
      </location>
      <direction>
        <x>0</x>
        <y>0</y>
        <z>-1</z>
      </direction>
    </force>

    <force name="rr_motor" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/rr_motor_lag</property>
          <value> 1.7 </value>
        </product>
      </function>
      <location unit="IN">
        <x>4.33</x>
        <y>2.5</y>
        <z>0</z>
      </location>
      <direction>
        <x>0</x>
        <y>0</y>
        <z>-1</z>
      </direction>
    </force>

    <force name="rl_motor" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/rl_motor_lag</property>
          <value> 1.7 </value>
        </product>
      </function>
      <location unit="IN">
        <x>4.33</x>
        <y>-2.5</y>
        <z>0</z>
      </location>
      <direction>
        <x>0</x>
        <y>0</y>
        <z>-1</z>
      </direction>
    </force>

    <force name="ml_motor" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/ml_motor_lag</property>
          <value> 1.7 </value>
        </product>
      </function>
      <location unit="IN">
        <x>0.0</x>
        <y>-5.0</y>
        <z>0</z>
      </location>
      <direction>
        <x>0</x>
        <y>0</y>
        <z>-1</z>
      </direction>
    </force>

    <force name="fl_motor" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/fl_motor_lag</property>
          <value> 1.7 </value>
        </product>
      </function>
      <location unit="IN">
        <x>-4.33</x>
        <y>-2.5</y>
        <z>0</z>
      </location>
      <direction>
        <x>0</x>
        <y>0</y>
        <z>-1</z>
      </direction>
    </force>

    <!-- Then the Moment Couples -->

    <!-- 
      >>> np.array([5*np.sin(th)]).T + np.array([1.9685, -1.9685])
    -->

    <force name="fr_couple1" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/yawcontrol</property>
          <value> 1.0 </value>
        </product>
      </function>
      <location unit="IN">
        <!-- Necessary arm in IN to produce a moment ten times
        "weaker" then the force when both are measured in the SI is 1.9685 in. -->
        <x>0.0</x>
        <y>4.4685</y>
        <z>0</z>
      </location>
      <direction>
        <x>-1</x>
        <y>0</y>
        <z>0</z>
      </direction>
    </force>

    <force name="fr_couple2" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/yawcontrol</property>
          <value> 1.0 </value>
        </product>
      </function>
      <location unit="IN">
        <x>0.0</x>
        <y>0.5315</y>
        <z>0</z>
      </location>
      <direction>
        <x>1</x>
        <y>0</y>
        <z>0</z>
      </direction>
    </force>



    <force name="mr_couple1" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/yawcontrol1</property>
          <value> 1.0 </value>
        </product>
      </function>
      <location unit="IN">
        <x>0.0</x>
        <y>6.9685</y>
        <z>0</z>
      </location>
      <direction>
        <x>1</x>
        <y>0</y>
        <z>0</z>
      </direction>
    </force>

    <force name="mr_couple2" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/yawcontrol1</property>
          <value> 1.0 </value>
        </product>
      </function>
      <location unit="IN">
        <x>0.0</x>
        <y>3.0315</y>
        <z>0</z>
      </location>
      <direction>
        <x>-1</x>
        <y>0</y>
        <z>0</z>
      </direction>
    </force>



    <force name="rr_couple1" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/yawcontrol2</property>
          <value> 1.0 </value>
        </product>
      </function>
      <location unit="IN">
        <x>0.0</x>
        <y>4.4685</y>
        <z>0</z>
      </location>
      <direction>
        <x>-1</x>
        <y>0</y>
        <z>0</z>
      </direction>
    </force>

    <force name="rr_couple2" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/yawcontrol2</property>
          <value> 1.0 </value>
        </product>
      </function>
      <location unit="IN">
        <x>0.0</x>
        <y>0.5315</y>
        <z>0</z>
      </location>
      <direction>
        <x>1</x>
        <y>0</y>
        <z>0</z>
      </direction>
    </force>



    <force name="rl_couple1" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/yawcontrol3</property>
          <value> 1.0 </value>
        </product>
      </function>
      <location unit="IN">
        <x>0.0</x>
        <y>-0.5315</y>
        <z>0</z>
      </location>
      <direction>
        <x>1</x>
        <y>0</y>
        <z>0</z>
      </direction>
    </force>

    <force name="rl_couple2" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/yawcontrol3</property>
          <value> 1.0 </value>
        </product>
      </function>
      <location unit="IN">
        <x>0.0</x>
        <y>-4.4685</y>
        <z>0</z>
      </location>
      <direction>
        <x>-1</x>
        <y>0</y>
        <z>0</z>
      </direction>
    </force>

    <force name="ml_couple1" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/yawcontrol4</property>
          <value> 1.0 </value>
        </product>
      </function>
      <location unit="IN">
        <x>0.0</x>
        <y>-3.0315</y>
        <z>0</z>
      </location>
      <direction>
        <x>-1</x>
        <y>0</y>
        <z>0</z>
      </direction>
    </force>

    <force name="ml_couple2" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/yawcontrol4</property>
          <value> 1.0 </value>
        </product>
      </function>
      <location unit="IN">
        <x>0.0</x>
        <y>-6.9685</y>
        <z>0</z>
      </location>
      <direction>
        <x>1</x>
        <y>0</y>
        <z>0</z>
      </direction>
    </force>

    <force name="fl_couple1" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/yawcontrol5</property>
          <value> 1.0 </value>
        </product>
      </function>
      <location unit="IN">
        <x>0.0</x>
        <y>-0.5315</y>
        <z>0</z>
      </location>
      <direction>
        <x>1</x>
        <y>0</y>
        <z>0</z>
      </direction>
    </force>

    <force name="fl_couple2" frame="BODY" unit="LBS">
      <function>
        <product>
          <property>fcs/yawcontrol5</property>
          <value> 1.0 </value>
        </product>
      </function>
      <location unit="IN">
        <x>0.0</x>
        <y>-4.4685</y>
        <z>0</z>
      </location>
      <direction>
        <x>-1</x>
        <y>0</y>
        <z>0</z>
      </direction>
    </force>
  </external_reactions>

  <propulsion/>

  <flight_control name="FGFCS"/>

  <aerodynamics>
    <axis name="DRAG">
      <function name="aero/coefficient/CD">
        <description>Drag</description>
        <product>
          <property>aero/qbar-psf</property>
          <value>47.9</value> <!-- Conversion to pascals -->
          <value>0.0151</value> <!-- CD x Area (m^2) -->
          <value>0.224808943</value> <!-- N to LBS -->
        </product>
      </function>
    </axis>
  </aerodynamics>

</fdm_config>
