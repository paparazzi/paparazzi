<?xml version="1.0"?>
<?xml-stylesheet type="text/xsl" href="http://jsbsim.sourceforge.net/JSBSim.xsl"?>
<fdm_config name="FA Hex" version="2.0" release="BETA" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://jsbsim.sourceforge.net/JSBSim.xsd">

  <fileheader>
    <author>Mohamad Hachem</author>
    <filecreationdate>1-02-2025</filecreationdate>
    <version>Version 1.0</version>
    <description>
      Model for Fully Actauted Hexacopter copied from anton quadrotor Done by Gautier Hattenberge
      Simple Quadrotor in X configuration
      Motor: T-Motor F40 + prop 6045
      Include rotor dynamic
      NE/SW turning CCW, NW/SE CW

      Drag model is linear with speed and correspond to the quadrotor used in
      IMAV2021 paper "Estimating wind using a quadrotor" (Hattenberger, Bronz, Condomines)
    </description>
  </fileheader>

  <metrics>
    <wingarea unit="M2"> 1 </wingarea>
    <wingspan unit="M"> 1 </wingspan>
    <chord unit="M"> 1 </chord>
    <htailarea unit="M2"> 0 </htailarea>
    <htailarm unit="M"> 0 </htailarm>
    <vtailarea unit="M2"> 0 </vtailarea>
    <vtailarm unit="M"> 0 </vtailarm>
    <location name="AERORP" unit="M">
      <x> 0 </x>
      <y> 0 </y>
      <z> 0 </z>
    </location>
    <location name="EYEPOINT" unit="M">
      <x> 0 </x>
      <y> 0 </y>
      <z> 0 </z>
    </location>
    <location name="VRP" unit="M">
      <x> 0 </x>
      <y> 0 </y>
      <z> 0 </z>
    </location>
  </metrics>

  <mass_balance>
    <ixx unit="KG*M2"> 0.0068 </ixx>
    <iyy unit="KG*M2"> 0.0068 </iyy>
    <izz unit="KG*M2"> 0.0136 </izz>
    <ixy unit="KG*M2"> 0. </ixy>
    <ixz unit="KG*M2"> 0. </ixz>
    <iyz unit="KG*M2"> 0. </iyz>
    <emptywt unit="KG"> 0.65 </emptywt>
    <location name="CG" unit="M">
      <x> 0 </x>
      <y> 0 </y>
      <z> 0 </z>
    </location>
  </mass_balance>

  <ground_reactions>
    <contact type="STRUCTURE" name="CONTACT_FRONT">
      <location unit="M">
        <x>-0.25 </x>
        <y> 0 </y>
        <z>-0.1 </z>
      </location>
      <static_friction>  0.8 </static_friction>
      <dynamic_friction> 0.5 </dynamic_friction>
      <spring_coeff unit="N/M"> 500 </spring_coeff>
      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
      <max_steer unit="DEG"> 0.0 </max_steer>
      <brake_group> NONE </brake_group>
      <retractable>0</retractable>
    </contact>

    <contact type="STRUCTURE" name="CONTACT_BACK">
      <location unit="M">
        <x> 0.25</x>
        <y> 0   </y>
        <z>-0.1 </z>
      </location>
      <static_friction>  0.8 </static_friction>
      <dynamic_friction> 0.5 </dynamic_friction>
      <spring_coeff unit="N/M"> 500 </spring_coeff>
      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
      <max_steer unit="DEG"> 0.0 </max_steer>
      <brake_group> NONE </brake_group>
      <retractable>0</retractable>
    </contact>

    <contact type="STRUCTURE" name="CONTACT_RIGHT">
      <location unit="M">
        <x> 0.  </x>
        <y> 0.25</y>
        <z>-0.1 </z>
      </location>
      <static_friction>  0.8 </static_friction>
      <dynamic_friction> 0.5 </dynamic_friction>
      <spring_coeff unit="N/M"> 500 </spring_coeff>
      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
      <max_steer unit="DEG"> 0.0 </max_steer>
      <brake_group> NONE </brake_group>
      <retractable>0</retractable>
    </contact>

    <contact type="STRUCTURE" name="CONTACT_LEFT">
      <location unit="M">
        <x> 0.  </x>
        <y>-0.25</y>
        <z>-0.1 </z>
      </location>
      <static_friction>  0.8 </static_friction>
      <dynamic_friction> 0.5 </dynamic_friction>
      <spring_coeff unit="N/M"> 500 </spring_coeff>
      <damping_coeff unit="N/M/SEC"> 100 </damping_coeff>
      <damping_coeff_rebound type="SQUARE" unit="N/M2/SEC2"> 1000 </damping_coeff_rebound>
      <max_steer unit="DEG"> 0.0 </max_steer>
      <brake_group> NONE </brake_group>
      <retractable>0</retractable>
    </contact>
  </ground_reactions>

<flight_control name="actuator_dynamics">

    <property value="30.">fcs/motor_lag</property>
    <property value="50.">fcs/motor_d_filter</property>
    <property value="1.">fcs/g1_gain</property>
    <property value="1.">fcs/g2_gain</property>

    <channel name="filtering">

      <!-- First order filter represents actuator dynamics -->
      <lag_filter name="motor1_lag">
        <input> fcs/motor1 </input>
        <c1> fcs/motor_lag </c1>
        <output> fcs/motor1_lag</output>
      </lag_filter>
      <lag_filter name="motor2_lag">
        <input> fcs/motor2 </input>
        <c1> fcs/motor_lag </c1>
        <output> fcs/motor2_lag</output>
      </lag_filter>
      <lag_filter name="motor3_lag">
        <input> fcs/motor3 </input>
        <c1> fcs/motor_lag </c1>
        <output> fcs/motor3_lag</output>
      </lag_filter>
      <lag_filter name="motor4_lag">
        <input> fcs/motor4 </input>
        <c1> fcs/motor_lag </c1>
        <output> fcs/motor4_lag</output>
      </lag_filter>
      <lag_filter name="motor5_lag">
        <input> fcs/motor5 </input>
        <c1> fcs/motor_lag </c1>
        <output> fcs/motor5_lag</output>
      </lag_filter>
      <lag_filter name="motor6_lag">
        <input> fcs/motor6 </input>
        <c1> fcs/motor_lag </c1>
        <output> fcs/motor6_lag</output>
      </lag_filter>

      <!-- Derivative of actuator dynamics for spin-up torque -->
      <washout_filter name="motor1_d">
        <input> fcs/motor1 </input>
        <c1> fcs/motor_d_filter </c1>
        <output> fcs/motor1_d</output>
      </washout_filter>
      <washout_filter name="motor2_d">
        <input> fcs/motor2 </input>
        <c1> fcs/motor_d_filter </c1>
        <output> fcs/motor2_d</output>
      </washout_filter>
      <washout_filter name="motor3_d">
        <input> fcs/motor3 </input>
        <c1> fcs/motor_d_filter </c1>
        <output> fcs/motor3_d</output>
      </washout_filter>
      <washout_filter name="motor4_d">
        <input> fcs/motor4 </input>
        <c1> fcs/motor_d_filter </c1>
        <output> fcs/motor4_d</output>
      </washout_filter>
      <washout_filter name="motor5_d">
        <input> fcs/motor5 </input>
        <c1> fcs/motor_d_filter </c1>
        <output> fcs/motor5_d</output>
      </washout_filter>
      <washout_filter name="motor6_d">
        <input> fcs/motor6 </input>
        <c1> fcs/motor_d_filter </c1>
        <output> fcs/motor6_d</output>
      </washout_filter>

      <!-- Gain and summation for yaw control -->
      <pure_gain name="motor1_g2timesactd">
        <input>fcs/motor1_d</input>
        <gain>fcs/g2_gain</gain>
        <output>fcs/motor1_g2timesactd</output>
      </pure_gain>
      <pure_gain name="motor1_g1timesact">
        <input>fcs/motor1_lag</input>
        <gain>fcs/g1_gain</gain>
        <output>fcs/motor1_g1timesact</output>
      </pure_gain>
      <summer name="motor1_summer">
        <input>fcs/motor1_g2timesactd</input>
        <input>fcs/motor1_g1timesact</input>
        <output>fcs/motor1_yawcontrol</output>
      </summer>

      <pure_gain name="motor2_g2timesactd">
        <input>fcs/motor2_d</input>
        <gain>fcs/g2_gain</gain>
        <output>fcs/motor2_g2timesactd</output>
      </pure_gain>
      <pure_gain name="motor2_g1timesact">
        <input>fcs/motor2_lag</input>
        <gain>fcs/g1_gain</gain>
        <output>fcs/motor2_g1timesact</output>
      </pure_gain>
      <summer name="motor2_summer">
        <input>fcs/motor2_g2timesactd</input>
        <input>fcs/motor2_g1timesact</input>
        <output>fcs/motor2_yawcontrol</output>
      </summer>

      <pure_gain name="motor3_g2timesactd">
        <input>fcs/motor3_d</input>
        <gain>fcs/g2_gain</gain>
        <output>fcs/motor3_g2timesactd</output>
      </pure_gain>
      <pure_gain name="motor3_g1timesact">
        <input>fcs/motor3_lag</input>
        <gain>fcs/g1_gain</gain>
        <output>fcs/motor3_g1timesact</output>
      </pure_gain>
      <summer name="motor3_summer">
        <input>fcs/motor3_g2timesactd</input>
        <input>fcs/motor3_g1timesact</input>
        <output>fcs/motor3_yawcontrol</output>
      </summer>

      <pure_gain name="motor4_g2timesactd">
        <input>fcs/motor4_d</input>
        <gain>fcs/g2_gain</gain>
        <output>fcs/motor4_g2timesactd</output>
      </pure_gain>
      <pure_gain name="motor4_g1timesact">
        <input>fcs/motor4_lag</input>
        <gain>fcs/g1_gain</gain>
        <output>fcs/motor4_g1timesact</output>
      </pure_gain>
      <summer name="motor4_summer">
        <input>fcs/motor4_g2timesactd</input>
        <input>fcs/motor4_g1timesact</input>
        <output>fcs/motor4_yawcontrol</output>
      </summer>

      <pure_gain name="motor5_g2timesactd">
        <input>fcs/motor5_d</input>
        <gain>fcs/g2_gain</gain>
        <output>fcs/motor5_g2timesactd</output>
      </pure_gain>
      <pure_gain name="motor5_g1timesact">
        <input>fcs/motor5_lag</input>
        <gain>fcs/g1_gain</gain>
        <output>fcs/motor5_g1timesact</output>
      </pure_gain>
      <summer name="motor5_summer">
        <input>fcs/motor5_g2timesactd</input>
        <input>fcs/motor5_g1timesact</input>
        <output>fcs/motor5_yawcontrol</output>
      </summer>
      
      <pure_gain name="motor6_g2timesactd">
        <input>fcs/motor6_d</input>
        <gain>fcs/g2_gain</gain>
        <output>fcs/motor6_g2timesactd</output>
      </pure_gain>
      <pure_gain name="motor6_g1timesact">
        <input>fcs/motor6_lag</input>
        <gain>fcs/g1_gain</gain>
        <output>fcs/motor6_g1timesact</output>
      </pure_gain>
      <summer name="motor6_summer">
        <input>fcs/motor6_g2timesactd</input>
        <input>fcs/motor6_g1timesact</input>
        <output>fcs/motor6_yawcontrol</output>
      </summer>
    </channel>
</flight_control>


 <external_reactions>
 
    <property>fcs/motor1</property>
    <property>fcs/motor2</property>
    <property>fcs/motor3</property>
    <property>fcs/motor4</property>
    <property>fcs/motor5</property>
    <property>fcs/motor6</property>
    <property>fcs/motor1_lag</property>
    <property>fcs/motor2_lag</property>
    <property>fcs/motor3_lag</property>
    <property>fcs/motor4_lag</property>
    <property>fcs/motor5_lag</property>
    <property>fcs/motor6_lag</property>

    <!-- First the lift forces produced by each propeller -->

    <force name="motor1" frame="BODY">
        <function>
            <product>
                <property>fcs/motor1_lag</property>
                <value>4.5</value>
                <value>0.224808943</value> 
            </product>
        </function>
        <location unit="M">
            <x>-0.1299</x>
            <y>0.075</y>
            <z>0</z>
        </location>
        <direction>
            <x>-0.171</x>   <!-- Fx = sin(0.3491) * cos(0°) -->
            <y>0.2962</y>   <!-- Fy = sin(0.3491) * sin(0°) -->
            <z>-0.9397</z>  <!-- Fz = cos(0.3491) -->
        </direction>
    </force>

    <force name="motor2" frame="BODY">
        <function>
            <product>
                <property>fcs/motor2_lag</property>
                <value>4.5</value>
                <value>0.224808943</value> 
            </product>
        </function>
        <location unit="M">
            <x>0.0</x>
            <y>0.15</y>
            <z>0</z>
        </location>
        <direction>
            <x>0.342</x>   <!-- Fx = sin(0.3491) * cos(0°) -->
            <y>0</y>   <!-- Fy = sin(0.3491) * sin(0°) -->
            <z>-0.9397</z>  <!-- Fz = cos(0.3491) -->
        </direction>
    </force>

    <force name="motor3" frame="BODY">
        <function>
            <product>
                <property>fcs/motor3_lag</property>
                <value>4.5</value>
                <value>0.224808943</value> 
            </product>
        </function>
        <location unit="M">
            <x>0.1299</x>
            <y>0.075</y>
            <z>0</z>
        </location>
        <direction>
            <x>-0.171</x>   <!-- Fx = sin(0.3491) * cos(0°) -->
            <y>-0.2962</y>   <!-- Fy = sin(0.3491) * sin(0°) -->
            <z>-0.9397</z>  <!-- Fz = cos(0.3491) -->
        </direction>
    </force>

    <force name="motor4" frame="BODY">
        <function>
            <product>
                <property>fcs/motor4_lag</property>
                <value>4.5</value>
                <value>0.224808943</value> 
            </product>
        </function>
        <location unit="M">
            <x>0.1299</x>
            <y>-0.075</y>
            <z>0</z>
        </location>
        <direction>
            <x>-0.171</x>   <!-- Fx = sin(0.3491) * cos(0°) -->
            <y>0.2962</y>   <!-- Fy = sin(0.3491) * sin(0°) -->
            <z>-0.9397</z>  <!-- Fz = cos(0.3491) -->
        </direction>
    </force>

     <force name="motor5" frame="BODY">
        <function>
            <product>
                <property>fcs/motor5_lag</property>
                <value>4.5</value>
                <value>0.224808943</value> 
            </product>
        </function>
        <location unit="M">
            <x>0</x>
            <y>-0.15</y>
            <z>0</z>
        </location>
        <direction>
            <x>0.342</x>   <!-- Fx = sin(0.3491) * cos(0°) -->
            <y>0</y>   <!-- Fy = sin(0.3491) * sin(0°) -->
            <z>-0.9397</z>  <!-- Fz = cos(0.3491) -->
        </direction>
    </force>  

     <force name="motor6" frame="BODY">
        <function>
            <product>
                <property>fcs/motor6_lag</property>
                <value>4.5</value>
                <value>0.224808943</value> 
            </product>
        </function>
        <location unit="M">
            <x>-0.1299</x>
            <y>-0.075</y>
            <z>0</z>
        </location>
        <direction>
            <x>-0.1710</x>   <!-- Fx = sin(0.3491) * cos(0°) -->
            <y>-0.2962</y>   <!-- Fy = sin(0.3491) * sin(0°) -->
            <z>-0.9397</z>  <!-- Fz = cos(0.3491) -->
        </direction>
    </force> 

    <!-- Then the Moment Couples -->

    <moment name="motor1_couple" frame="BODY">
      <function>
        <product>
          <property>fcs/motor1_yawcontrol</property>
          <value> 0.01 </value>
          <value> 0.738 </value> <!-- N.m to FT.LBS -->
        </product>
      </function>
      <location unit="M">
         <x>-0.1299</x>
         <y>0.075</y>
         <z>0</z>
      </location>
      <direction>
          <x>0.171</x>   <!-- Fx = sin(0.3491) * cos(0°) -->
          <y>-0.2962</y>   <!-- Fy = sin(0.3491) * sin(0°) -->
          <z>0.9397</z>   <!-- Fz = cos(0.3491) -->
      </direction>
    </moment>

    <moment name="motor2_couple" frame="BODY">
      <function>
        <product>
          <property>fcs/motor2_yawcontrol</property>
          <value> 0.01 </value>
          <value> 0.738 </value> <!-- N.m to FT.LBS -->
        </product>
      </function>
      <location unit="M">
        <x>0.0</x>
        <y>0.15</y>
        <z>0</z>
      </location>
      <direction>
        <x>0.342</x>   <!-- Fx = sin(0.3491) * cos(0°) -->
        <y>0</y>   <!-- Fy = sin(0.3491) * sin(0°) -->
        <z>-0.9397</z>  <!-- Fz = cos(0.3491) -->
        </direction>
    </moment>

    <moment name="motor3_couple" frame="BODY">
      <function>
        <product>
          <property>fcs/motor3_yawcontrol</property>
          <value> 0.01 </value>
          <value> 0.738 </value> <!-- N.m to FT.LBS -->
        </product>
      </function>
      <location unit="M">
        <x>0.1299</x>
        <y>0.075</y>
        <z>0</z>
      </location>
      <direction>
        <x>0.171</x>   <!-- Fx = sin(0.3491) * cos(0°) -->
        <y>0.2962</y>   <!-- Fy = sin(0.3491) * sin(0°) -->
        <z>0.9397</z>  <!-- Fz = cos(0.3491) -->
      </direction>
    </moment>

    <moment name="motor4_couple" frame="BODY">
      <function>
        <product>
          <property>fcs/motor4_yawcontrol</property>
          <value> 0.01 </value>
          <value> 0.738 </value> <!-- N.m to FT.LBS -->
        </product>
      </function>
      <location unit="M">
        <x>0.1299</x>
        <y>-0.075</y>
        <z>0</z>
      </location>
      <direction>
        <x>-0.171</x>   <!-- Fx = sin(0.3491) * cos(0°) -->
        <y>0.2962</y>   <!-- Fy = sin(0.3491) * sin(0°) -->
        <z>-0.9397</z>  <!-- Fz = cos(0.3491) -->
      </direction>
    </moment>

    <moment name="motor5_couple" frame="BODY">
      <function>
        <product>
          <property>fcs/motor5_yawcontrol</property>
          <value> 0.01 </value>
          <value> 0.738 </value> <!-- N.m to FT.LBS -->
        </product>
      </function>
      <location unit="M">
        <x>0</x>
        <y>-0.15</y>
        <z>0</z>
      </location>
      <direction>
        <x>-0.342</x>   <!-- Fx = sin(0.3491) * cos(0°) -->
        <y>0</y>   <!-- Fy = sin(0.3491) * sin(0°) -->
        <z>0.9397</z>  <!-- Fz = cos(0.3491) -->
      </direction>
    </moment>

    <moment name="motor6_couple" frame="BODY">
      <function>
        <product>
          <property>fcs/motor6_yawcontrol</property>
          <value> 0.01 </value>
          <value> 0.738 </value> <!-- N.m to FT.LBS -->
        </product>
      </function>
      <location unit="M">
        <x>-0.1299</x>
        <y>-0.075</y>
        <z>0</z>
      </location>
      <direction>
        <x>-0.1710</x>   <!-- Fx = sin(0.3491) * cos(0°) -->
        <y>-0.2962</y>   <!-- Fy = sin(0.3491) * sin(0°) -->
        <z>-0.9397</z>  <!-- Fz = cos(0.3491) -->
      </direction>
    </moment>

  </external_reactions>

  <propulsion/>

  <flight_control name="FGFCS"/>

  <aerodynamics>
    <axis name="DRAG">
      <function name="aero/coefficient/CD">
        <description>Drag</description>
        <product>
          <property>velocities/vtrue-fps</property>
          <value>0.3048</value> <!-- conversion in m/s -->
          <value>0.230292</value> <!-- drag coef -->
          <value>0.224808943</value> <!-- N to LBS -->
        </product>
      </function>
    </axis>
  </aerodynamics>

</fdm_config>
