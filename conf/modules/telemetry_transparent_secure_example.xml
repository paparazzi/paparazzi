<!DOCTYPE module SYSTEM "module.dtd">

<module name="telemetry_transparent_secure" dir="datalink" task="datalink">
  <doc>
    <description>
      Example of using secure telemetr over PPRZ protocol over UART
      
      This file serves only as an example and should not be used in real applications, 
      because it only passes though all data (so it is equivalent to using plaintext data).

      However, this example should make it easier for users to device their own encryption scheme.      
    </description>
    <configure name="MODEM_PORT" value="UARTx" description="UART where the modem is connected to (UART1, UART2, etc)"/>
    <configure name="MODEM_BAUD" value="B57600" description="UART baud rate"/>
  </doc>
  <!-- autoload secure_nps_example module to allow encryption for simulation and testing -->
  <!-- change accordingly when devising your own secure link -->
  <autoload name="telemetry" type="secure_nps_example"/>
  <autoload name="telemetry" type="sim"/>
  <header>
    <!-- required header file declaring spprz_transport -->
    <file name="spprz_dl.h"/>
  </header>
  <!-- required init and event functions -->
  <init fun="spprz_dl_init()"/>
  <event fun="spprz_dl_event()"/>
  <makefile target="!fbw|sim|nps|hitl">
    <configure name="MODEM_PORT" case="upper|lower"/>
    <define name="USE_$(MODEM_PORT_UPPER)"/>
    <define name="$(MODEM_PORT_UPPER)_BAUD" value="$(MODEM_BAUD)"/>
    <define name="DOWNLINK"/>
    <define name="PERIODIC_TELEMETRY"/>
    <define name="DOWNLINK_DEVICE" value="$(MODEM_PORT_LOWER)"/>
    <define name="PPRZ_UART" value="$(MODEM_PORT_LOWER)"/>
    <!-- we are using "spprz_tp" instead of "pprz_tp" --> 
    <define name="DOWNLINK_TRANSPORT" value="spprz_tp"/>
    <define name="DATALINK" value="PPRZ"/>
    <file name="downlink.c" dir="subsystems/datalink"/>
    <file name="datalink.c" dir="subsystems/datalink"/>
    <file name="telemetry.c" dir="subsystems/datalink"/>    
    <!-- provide your own source file, or expand the template one -->
    <file name="spprz_dl.c"/>
    <!-- required files, defining the secure transport -->
    <file name="spprz_transport.c" dir="pprzlink/src"/>
    <!-- and providing default pass-through implementation -->
    <!-- this file shouldn't be used in your implementation -->
    <file name="spprz_utils.c" dir="pprzlink/src"/>
  </makefile>
  <makefile target="ap" firmware="fixedwing">
    <file name="fixedwing_datalink.c" dir="$(SRC_FIRMWARE)"/>
    <file name="ap_downlink.c" dir="$(SRC_FIRMWARE)"/>
  </makefile>
  <makefile target="ap|fbw" firmware="fixedwing">
    <file name="fbw_downlink.c" dir="$(SRC_FIRMWARE)"/>
  </makefile>
  <makefile target="ap" firmware="rotorcraft">
    <file name="rotorcraft_datalink.c" dir="$(SRC_FIRMWARE)"/>
    <file name="rotorcraft_telemetry.c" dir="$(SRC_FIRMWARE)"/>
  </makefile>
</module>

